<!DOCTYPE html><html lang="zh-CN"><head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <title>python文档 - 掘金量化(www.myquant.cn)</title>
    <link href="../css/editormd.css" rel="stylesheet"/>
    <link rel="stylesheet" href="../css/myquant.css"/>
</head>
<body>
<div class="m-manual manual-reader">
    <div class="container-fluid manual-body">

        <div class="manual-article">
            <div class="article-content">
                <h1 id="article-title">快速开始 - 快速创建我的策略</h1>
                <div class="article-body  markdown-body editormd-preview-container" id="page-content">
                    <div class="markdown-toc editormd-markdown-toc"><ul class="markdown-toc-list"><li><a class="toc-level-2" href="#定时任务" level="2">定时任务</a></li><li><a class="toc-level-2" href="#数据事件驱动" level="2">数据事件驱动</a></li><li><a class="toc-level-2" href="#时间序列数据事件驱动" level="2">时间序列数据事件驱动</a></li><li><a class="toc-level-2" href="#多个代码数据事件驱动" level="2">多个代码数据事件驱动</a></li><li><a class="toc-level-2" href="#默认账户交易" level="2">默认账户交易</a></li><li><a class="toc-level-2" href="#指定账户交易" level="2">指定账户交易</a></li><li><a class="toc-level-2" href="#回测模式与实时模式" level="2">回测模式与实时模式</a><ul><li><a class="toc-level-3" href="#回测模式" level="3">回测模式</a></li><li><a class="toc-level-3" href="#实时模式" level="3">实时模式</a></li></ul></li><li><a class="toc-level-2" href="#提取数据研究" level="2">提取数据研究</a><ul></ul></li></ul></div><h2 id="h2-u5B9Au65F6u4EFBu52A1"><a name="定时任务" class="reference-link"></a><span class="header-link octicon octicon-link"></span>定时任务</h2><p>以下的范例代码片段是一个非常简单的例子， 在每个交易日的14：50：00 市价购买200股浦发银行股票：</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-python"><span class="com"># coding=utf-8</span></code></li><li class="L1"><code class="lang-python"><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> print_function</span><span class="pun">,</span><span class="pln"> absolute_import</span><span class="pun">,</span><span class="pln"> unicode_literals</span></code></li><li class="L2"><code class="lang-python"></code></li><li class="L3"><code class="lang-python"><span class="kwd">from</span><span class="pln"> gm</span><span class="pun">.</span><span class="pln">api </span><span class="kwd">import</span><span class="pln"> </span><span class="pun">*</span></code></li><li class="L4"><code class="lang-python"></code></li><li class="L5"><code class="lang-python"><span class="kwd">def</span><span class="pln"> init</span><span class="pun">(</span><span class="pln">context</span><span class="pun">):</span></code></li><li class="L6"><code class="lang-python"><span class="pln">    schedule</span><span class="pun">(</span><span class="pln">schedule_func</span><span class="pun">=</span><span class="pln">algo</span><span class="pun">,</span><span class="pln"> date_rule</span><span class="pun">=</span><span class="str">&#39;1d&#39;</span><span class="pun">,</span><span class="pln"> time_rule</span><span class="pun">=</span><span class="str">&#39;14:50:00&#39;</span><span class="pun">)</span></code></li><li class="L7"><code class="lang-python"></code></li><li class="L8"><code class="lang-python"></code></li><li class="L9"><code class="lang-python"><span class="kwd">def</span><span class="pln"> algo</span><span class="pun">(</span><span class="pln">context</span><span class="pun">):</span></code></li><li class="L0"><code class="lang-python"><span class="pln">    </span><span class="com"># 购买200股浦发银行股票</span></code></li><li class="L1"><code class="lang-python"><span class="pln">    order_volume</span><span class="pun">(</span><span class="pln">symbol</span><span class="pun">=</span><span class="str">&#39;SHSE.600000&#39;</span><span class="pun">,</span><span class="pln"> volume</span><span class="pun">=</span><span class="lit">200</span><span class="pun">,</span><span class="pln"> side</span><span class="pun">=</span><span class="typ">OrderSide_Buy</span><span class="pun">,</span><span class="pln"> order_type</span><span class="pun">=</span><span class="typ">OrderType_Market</span><span class="pun">,</span><span class="pln"> position_effect</span><span class="pun">=</span><span class="typ">PositionEffect_Open</span><span class="pun">,</span><span class="pln"> price</span><span class="pun">=</span><span class="lit">0</span><span class="pun">)</span></code></li><li class="L2"><code class="lang-python"></code></li><li class="L3"><code class="lang-python"></code></li><li class="L4"><code class="lang-python"><span class="kwd">if</span><span class="pln"> __name__ </span><span class="pun">==</span><span class="pln"> </span><span class="str">&#39;__main__&#39;</span><span class="pun">:</span></code></li><li class="L5"><code class="lang-python"><span class="pln">    run</span><span class="pun">(</span><span class="pln">strategy_id</span><span class="pun">=</span><span class="str">&#39;strategy_1&#39;</span><span class="pun">,</span><span class="pln"> filename</span><span class="pun">=</span><span class="str">&#39;main.py&#39;</span><span class="pun">,</span><span class="pln"> mode</span><span class="pun">=</span><span class="pln">MODE_BACKTEST</span><span class="pun">,</span><span class="pln"> token</span><span class="pun">=</span><span class="str">&#39;token_id&#39;</span><span class="pun">,</span></code></li><li class="L6"><code class="lang-python"><span class="pln">        backtest_start_time</span><span class="pun">=</span><span class="str">&#39;2016-06-17 13:00:00&#39;</span><span class="pun">,</span><span class="pln"> backtest_end_time</span><span class="pun">=</span><span class="str">&#39;2017-08-21 15:00:00&#39;</span><span class="pun">)</span></code></li></ol></pre>
<p>整个策略需要三步:</p>
<ol>
<li>设置初始化函数: <a href="/docs/python/python_basic#init---初始化策略">init</a> , 使用 <a href="/docs/python/python_basic#schedule---定时任务配置">schedule</a> 函数进行定时任务配置</li><li>配置任务, 到点会执行该任务</li><li>执行策略</li></ol>
<h2 id="h2-u6570u636Eu4E8Bu4EF6u9A71u52A8"><a name="数据事件驱动" class="reference-link"></a><span class="header-link octicon octicon-link"></span>数据事件驱动</h2><p>策略订阅的每个代码的每一个bar, 都会触发策略逻辑</p>
<p>以下的范例代码片段是一个非常简单的例子， 订阅浦发银行的日线bar, bar数据的更新会自动触发on_bar的调用：</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-python"><span class="com"># coding=utf-8</span></code></li><li class="L1"><code class="lang-python"><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> print_function</span><span class="pun">,</span><span class="pln"> absolute_import</span><span class="pun">,</span><span class="pln"> unicode_literals</span></code></li><li class="L2"><code class="lang-python"><span class="kwd">from</span><span class="pln"> gm</span><span class="pun">.</span><span class="pln">api </span><span class="kwd">import</span><span class="pln"> </span><span class="pun">*</span></code></li><li class="L3"><code class="lang-python"></code></li><li class="L4"><code class="lang-python"></code></li><li class="L5"><code class="lang-python"><span class="kwd">def</span><span class="pln"> init</span><span class="pun">(</span><span class="pln">context</span><span class="pun">):</span></code></li><li class="L6"><code class="lang-python"><span class="pln">    subscribe</span><span class="pun">(</span><span class="pln">symbols</span><span class="pun">=</span><span class="str">&#39;SHSE.600000&#39;</span><span class="pun">,</span><span class="pln"> frequency</span><span class="pun">=</span><span class="str">&#39;1d&#39;</span><span class="pun">)</span></code></li><li class="L7"><code class="lang-python"></code></li><li class="L8"><code class="lang-python"></code></li><li class="L9"><code class="lang-python"><span class="kwd">def</span><span class="pln"> on_bar</span><span class="pun">(</span><span class="pln">context</span><span class="pun">,</span><span class="pln"> bars</span><span class="pun">):</span></code></li><li class="L0"><code class="lang-python"><span class="pln">    </span><span class="com"># 打印当前获取的bar信息</span></code></li><li class="L1"><code class="lang-python"><span class="pln">    bar </span><span class="pun">=</span><span class="pln"> bars</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span></code></li><li class="L2"><code class="lang-python"><span class="pln">    </span><span class="com"># 执行策略逻辑操作</span></code></li><li class="L3"><code class="lang-python"><span class="pln">    </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">bar</span><span class="pun">)</span></code></li><li class="L4"><code class="lang-python"></code></li><li class="L5"><code class="lang-python"><span class="kwd">if</span><span class="pln"> __name__ </span><span class="pun">==</span><span class="pln"> </span><span class="str">&#39;__main__&#39;</span><span class="pun">:</span></code></li><li class="L6"><code class="lang-python"><span class="pln">    run</span><span class="pun">(</span><span class="pln">strategy_id</span><span class="pun">=</span><span class="str">&#39;strategy_1&#39;</span><span class="pun">,</span><span class="pln"> filename</span><span class="pun">=</span><span class="str">&#39;main.py&#39;</span><span class="pun">,</span><span class="pln"> mode</span><span class="pun">=</span><span class="pln">MODE_BACKTEST</span><span class="pun">,</span><span class="pln"> token</span><span class="pun">=</span><span class="str">&#39;token_id&#39;</span><span class="pun">,</span></code></li><li class="L7"><code class="lang-python"><span class="pln">        backtest_start_time</span><span class="pun">=</span><span class="str">&#39;2016-06-17 13:00:00&#39;</span><span class="pun">,</span><span class="pln"> backtest_end_time</span><span class="pun">=</span><span class="str">&#39;2017-08-21 15:00:00&#39;</span><span class="pun">)</span></code></li></ol></pre>
<p>整个策略需要三步:</p>
<ol>
<li>设置初始化函数: init, 使用subscribe函数进行数据订阅</li><li>实现一个函数: on_bar, 来根据数据推送进行逻辑处理</li><li>执行策略</li></ol>
<h2 id="h2-u65F6u95F4u5E8Fu5217u6570u636Eu4E8Bu4EF6u9A71u52A8"><a name="时间序列数据事件驱动" class="reference-link"></a><span class="header-link octicon octicon-link"></span>时间序列数据事件驱动</h2><p>策略订阅代码时指定数据窗口大小与周期, 平台创建数据滑动窗口, 加载初始数据, 并在新的bar到来时自动刷新数据。</p>
<p>on_bar事件触发时, 策略可以取到订阅代码的准备好的时间序列数据。</p>
<p>以下的范例代码片段是一个非常简单的例子， 订阅浦发银行的日线bar, bar数据的更新会自动触发on_bar的调用, 每次调用<code>context.data</code>来获取最新的50条日线bar信息：</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-python"><span class="com"># coding=utf-8</span></code></li><li class="L1"><code class="lang-python"><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> print_function</span><span class="pun">,</span><span class="pln"> absolute_import</span><span class="pun">,</span><span class="pln"> unicode_literals</span></code></li><li class="L2"><code class="lang-python"><span class="kwd">from</span><span class="pln"> gm</span><span class="pun">.</span><span class="pln">api </span><span class="kwd">import</span><span class="pln"> </span><span class="pun">*</span></code></li><li class="L3"><code class="lang-python"></code></li><li class="L4"><code class="lang-python"></code></li><li class="L5"><code class="lang-python"><span class="kwd">def</span><span class="pln"> init</span><span class="pun">(</span><span class="pln">context</span><span class="pun">):</span></code></li><li class="L6"><code class="lang-python"><span class="pln">    subscribe</span><span class="pun">(</span><span class="pln">symbols</span><span class="pun">=</span><span class="str">&#39;SHSE.600000&#39;</span><span class="pun">,</span><span class="pln"> frequency</span><span class="pun">=</span><span class="str">&#39;1d&#39;</span><span class="pun">,</span><span class="pln"> count</span><span class="pun">=</span><span class="lit">50</span><span class="pun">)</span></code></li><li class="L7"><code class="lang-python"></code></li><li class="L8"><code class="lang-python"></code></li><li class="L9"><code class="lang-python"><span class="kwd">def</span><span class="pln"> on_bar</span><span class="pun">(</span><span class="pln">context</span><span class="pun">,</span><span class="pln"> bars</span><span class="pun">):</span></code></li><li class="L0"><code class="lang-python"><span class="pln">    </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">context</span><span class="pun">.</span><span class="pln">data</span><span class="pun">(</span><span class="pln">symbol</span><span class="pun">=</span><span class="str">&#39;SHSE.600000&#39;</span><span class="pun">,</span><span class="pln"> frequency</span><span class="pun">=</span><span class="str">&#39;1d&#39;</span><span class="pun">,</span><span class="pln"> count</span><span class="pun">=</span><span class="lit">50</span><span class="pun">,</span><span class="pln"> fields</span><span class="pun">=</span><span class="str">&#39;close,bob&#39;</span><span class="pun">))</span></code></li><li class="L1"><code class="lang-python"></code></li><li class="L2"><code class="lang-python"></code></li><li class="L3"><code class="lang-python"><span class="kwd">if</span><span class="pln"> __name__ </span><span class="pun">==</span><span class="pln"> </span><span class="str">&#39;__main__&#39;</span><span class="pun">:</span></code></li><li class="L4"><code class="lang-python"><span class="pln">    run</span><span class="pun">(</span><span class="pln">strategy_id</span><span class="pun">=</span><span class="str">&#39;strategy_1&#39;</span><span class="pun">,</span><span class="pln"> filename</span><span class="pun">=</span><span class="str">&#39;main.py&#39;</span><span class="pun">,</span><span class="pln"> mode</span><span class="pun">=</span><span class="pln">MODE_BACKTEST</span><span class="pun">,</span><span class="pln"> token</span><span class="pun">=</span><span class="str">&#39;token_id&#39;</span><span class="pun">,</span></code></li><li class="L5"><code class="lang-python"><span class="pln">        backtest_start_time</span><span class="pun">=</span><span class="str">&#39;2016-06-17 13:00:00&#39;</span><span class="pun">,</span><span class="pln"> backtest_end_time</span><span class="pun">=</span><span class="str">&#39;2017-08-21 15:00:00&#39;</span><span class="pun">)</span></code></li></ol></pre>
<p>整个策略需要三步:</p>
<ol>
<li>设置初始化函数: <a href="/docs/python/python_basic#init---初始化策略">init</a> , 使用 <a href="/docs/python/python_subscribe#subscribe---行情订阅">subscribe</a> 函数进行数据订阅</li><li>实现一个函数: <a href="/docs/python/python_data_event#on_bar---bar数据推送事件">on_bar</a> , 来根据数据推送进行逻辑处理, 通过 <code>context.data</code> 获取数据滑窗</li><li>执行策略</li></ol>
<h2 id="h2-u591Au4E2Au4EE3u7801u6570u636Eu4E8Bu4EF6u9A71u52A8"><a name="多个代码数据事件驱动" class="reference-link"></a><span class="header-link octicon octicon-link"></span>多个代码数据事件驱动</h2><p>策略订阅多个代码, 并且要求同一频度的数据到齐后, 再触发事件.</p>
<p>以下的范例代码片段是一个非常简单的例子， 订阅浦发银行和平安银行的日线bar, 在浦发银行bar和平安银行bar到齐后会自动触发on_bar的调用：</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-python"><span class="com"># coding=utf-8</span></code></li><li class="L1"><code class="lang-python"><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> print_function</span><span class="pun">,</span><span class="pln"> absolute_import</span><span class="pun">,</span><span class="pln"> unicode_literals</span></code></li><li class="L2"><code class="lang-python"><span class="kwd">from</span><span class="pln"> gm</span><span class="pun">.</span><span class="pln">api </span><span class="kwd">import</span><span class="pln"> </span><span class="pun">*</span></code></li><li class="L3"><code class="lang-python"></code></li><li class="L4"><code class="lang-python"></code></li><li class="L5"><code class="lang-python"><span class="kwd">def</span><span class="pln"> init</span><span class="pun">(</span><span class="pln">context</span><span class="pun">):</span></code></li><li class="L6"><code class="lang-python"><span class="pln">    subscribe</span><span class="pun">(</span><span class="pln">symbols</span><span class="pun">=</span><span class="str">&#39;SHSE.600000,SZSE.000001&#39;</span><span class="pun">,</span><span class="pln"> frequency</span><span class="pun">=</span><span class="str">&#39;1d&#39;</span><span class="pun">,</span><span class="pln"> count</span><span class="pun">=</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> wait_group</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span></code></li><li class="L7"><code class="lang-python"></code></li><li class="L8"><code class="lang-python"></code></li><li class="L9"><code class="lang-python"><span class="kwd">def</span><span class="pln"> on_bar</span><span class="pun">(</span><span class="pln">context</span><span class="pun">,</span><span class="pln"> bars</span><span class="pun">):</span></code></li><li class="L0"><code class="lang-python"><span class="pln">    </span><span class="kwd">for</span><span class="pln"> bar </span><span class="kwd">in</span><span class="pln"> bars</span><span class="pun">:</span></code></li><li class="L1"><code class="lang-python"><span class="pln">        </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">bar</span><span class="pun">[</span><span class="str">&#39;symbol&#39;</span><span class="pun">],</span><span class="pln"> bar</span><span class="pun">[</span><span class="str">&#39;eob&#39;</span><span class="pun">])</span></code></li><li class="L2"><code class="lang-python"></code></li><li class="L3"><code class="lang-python"></code></li><li class="L4"><code class="lang-python"><span class="kwd">if</span><span class="pln"> __name__ </span><span class="pun">==</span><span class="pln"> </span><span class="str">&#39;__main__&#39;</span><span class="pun">:</span></code></li><li class="L5"><code class="lang-python"><span class="pln">    run</span><span class="pun">(</span><span class="pln">strategy_id</span><span class="pun">=</span><span class="str">&#39;strategy_1&#39;</span><span class="pun">,</span><span class="pln"> filename</span><span class="pun">=</span><span class="str">&#39;main.py&#39;</span><span class="pun">,</span><span class="pln"> mode</span><span class="pun">=</span><span class="pln">MODE_BACKTEST</span><span class="pun">,</span><span class="pln"> token</span><span class="pun">=</span><span class="str">&#39;token_id&#39;</span><span class="pun">,</span></code></li><li class="L6"><code class="lang-python"><span class="pln">        backtest_start_time</span><span class="pun">=</span><span class="str">&#39;2016-06-17 13:00:00&#39;</span><span class="pun">,</span><span class="pln"> backtest_end_time</span><span class="pun">=</span><span class="str">&#39;2017-08-21 15:00:00&#39;</span><span class="pun">)</span></code></li></ol></pre>
<p>整个策略需要三步:</p>
<ol>
<li>设置初始化函数: <a href="/docs/python/python_basic#init---初始化策略">init</a> , 使用 <a href="/docs/python/python_subscribe#subscribe---行情订阅">subscribe</a> 函数进行数据订阅多个代码， 设置wait_group=True</li><li>实现一个函数: <a href="/docs/python/python_data_event#on_bar---bar数据推送事件">on_bar</a> , 来根据数据推送(多个代码行情)进行逻辑处理</li><li>执行策略</li></ol>
<h2 id="h2-u9ED8u8BA4u8D26u6237u4EA4u6613"><a name="默认账户交易" class="reference-link"></a><span class="header-link octicon octicon-link"></span>默认账户交易</h2><p>如果策略只关联一个账户，该账户是策略的默认账户。</p>
<p>进行交易时可以不指定交易账户， 以默认账户进行交易。</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-python"><span class="com"># coding=utf-8</span></code></li><li class="L1"><code class="lang-python"><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> print_function</span><span class="pun">,</span><span class="pln"> absolute_import</span><span class="pun">,</span><span class="pln"> unicode_literals</span></code></li><li class="L2"><code class="lang-python"><span class="kwd">from</span><span class="pln"> gm</span><span class="pun">.</span><span class="pln">api </span><span class="kwd">import</span><span class="pln"> </span><span class="pun">*</span></code></li><li class="L3"><code class="lang-python"></code></li><li class="L4"><code class="lang-python"></code></li><li class="L5"><code class="lang-python"><span class="kwd">def</span><span class="pln"> init</span><span class="pun">(</span><span class="pln">context</span><span class="pun">):</span></code></li><li class="L6"><code class="lang-python"><span class="pln">    subscribe</span><span class="pun">(</span><span class="pln">symbols</span><span class="pun">=</span><span class="str">&#39;SHSE.600000,SZSE.000001&#39;</span><span class="pun">,</span><span class="pln"> frequency</span><span class="pun">=</span><span class="str">&#39;1d&#39;</span><span class="pun">)</span></code></li><li class="L7"><code class="lang-python"></code></li><li class="L8"><code class="lang-python"><span class="kwd">def</span><span class="pln"> on_bar</span><span class="pun">(</span><span class="pln">context</span><span class="pun">,</span><span class="pln"> bars</span><span class="pun">):</span></code></li><li class="L9"><code class="lang-python"><span class="pln">    </span><span class="kwd">for</span><span class="pln"> bar </span><span class="kwd">in</span><span class="pln"> bars</span><span class="pun">:</span></code></li><li class="L0"><code class="lang-python"><span class="pln">        order_volume</span><span class="pun">(</span><span class="pln">symbol</span><span class="pun">=</span><span class="pln">bar</span><span class="pun">[</span><span class="str">&#39;symbol&#39;</span><span class="pun">],</span><span class="pln"> volume</span><span class="pun">=</span><span class="lit">200</span><span class="pun">,</span><span class="pln">  side</span><span class="pun">=</span><span class="typ">OrderSide_Buy</span><span class="pun">,</span></code></li><li class="L1"><code class="lang-python"><span class="pln">                     order_type</span><span class="pun">=</span><span class="typ">OrderType_Market</span><span class="pun">,</span></code></li><li class="L2"><code class="lang-python"><span class="pln">                     position_effect</span><span class="pun">=</span><span class="typ">PositionEffect_Open</span><span class="pun">,</span><span class="pln"> price</span><span class="pun">=</span><span class="lit">0</span><span class="pun">)</span></code></li><li class="L3"><code class="lang-python"></code></li><li class="L4"><code class="lang-python"><span class="kwd">if</span><span class="pln"> __name__ </span><span class="pun">==</span><span class="pln"> </span><span class="str">&#39;__main__&#39;</span><span class="pun">:</span></code></li><li class="L5"><code class="lang-python"><span class="pln">    run</span><span class="pun">(</span><span class="pln">strategy_id</span><span class="pun">=</span><span class="str">&#39;strategy_1&#39;</span><span class="pun">,</span><span class="pln"> filename</span><span class="pun">=</span><span class="str">&#39;main.py&#39;</span><span class="pun">,</span><span class="pln"> mode</span><span class="pun">=</span><span class="pln">MODE_BACKTEST</span><span class="pun">,</span><span class="pln"> token</span><span class="pun">=</span><span class="str">&#39;token_id&#39;</span><span class="pun">,</span></code></li><li class="L6"><code class="lang-python"><span class="pln">       backtest_start_time</span><span class="pun">=</span><span class="str">&#39;2016-06-17 13:00:00&#39;</span><span class="pun">,</span><span class="pln"> backtest_end_time</span><span class="pun">=</span><span class="str">&#39;2017-08-21 15:00:00&#39;</span><span class="pun">)</span></code></li></ol></pre>
<h2 id="h2-u6307u5B9Au8D26u6237u4EA4u6613"><a name="指定账户交易" class="reference-link"></a><span class="header-link octicon octicon-link"></span>指定账户交易</h2><p>如果策略在多个账户交易，需要显式指定交易账户。</p>
<p>以下的范例代码片段是一个非常简单的例子， 在下单时使用指定账户<code>account=&#39;account_1&#39;（参数为账户名称或账户ID）</code>来进行交易：</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-python"><span class="com"># coding=utf-8</span></code></li><li class="L1"><code class="lang-python"><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> print_function</span><span class="pun">,</span><span class="pln"> absolute_import</span><span class="pun">,</span><span class="pln"> unicode_literals</span></code></li><li class="L2"><code class="lang-python"><span class="kwd">from</span><span class="pln"> gm</span><span class="pun">.</span><span class="pln">api </span><span class="kwd">import</span><span class="pln"> </span><span class="pun">*</span></code></li><li class="L3"><code class="lang-python"></code></li><li class="L4"><code class="lang-python"></code></li><li class="L5"><code class="lang-python"><span class="kwd">def</span><span class="pln"> init</span><span class="pun">(</span><span class="pln">context</span><span class="pun">):</span></code></li><li class="L6"><code class="lang-python"><span class="pln">    subscribe</span><span class="pun">(</span><span class="pln">symbols</span><span class="pun">=</span><span class="str">&#39;SHSE.600000,SZSE.000001&#39;</span><span class="pun">,</span><span class="pln"> frequency</span><span class="pun">=</span><span class="str">&#39;1m&#39;</span><span class="pun">)</span></code></li><li class="L7"><code class="lang-python"></code></li><li class="L8"><code class="lang-python"><span class="kwd">def</span><span class="pln"> on_bar</span><span class="pun">(</span><span class="pln">context</span><span class="pun">,</span><span class="pln"> bars</span><span class="pun">):</span></code></li><li class="L9"><code class="lang-python"><span class="pln">    </span><span class="kwd">for</span><span class="pln"> bar </span><span class="kwd">in</span><span class="pln"> bars</span><span class="pun">:</span></code></li><li class="L0"><code class="lang-python"><span class="pln">      order_volume</span><span class="pun">(</span><span class="pln">symbol</span><span class="pun">=</span><span class="pln">bar</span><span class="pun">[</span><span class="str">&#39;symbol&#39;</span><span class="pun">],</span><span class="pln"> volume</span><span class="pun">=</span><span class="lit">200</span><span class="pun">,</span><span class="pln">  side</span><span class="pun">=</span><span class="typ">OrderSide_Buy</span><span class="pun">,</span></code></li><li class="L1"><code class="lang-python"><span class="pln">                 order_type</span><span class="pun">=</span><span class="typ">OrderType_Market</span><span class="pun">,</span></code></li><li class="L2"><code class="lang-python"><span class="pln">                 position_effect</span><span class="pun">=</span><span class="typ">PositionEffect_Open</span><span class="pun">,</span><span class="pln"> price</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> account</span><span class="pun">=</span><span class="str">&#39;account_1&#39;</span><span class="pun">)</span></code></li><li class="L3"><code class="lang-python"></code></li><li class="L4"><code class="lang-python"></code></li><li class="L5"><code class="lang-python"><span class="kwd">if</span><span class="pln"> __name__ </span><span class="pun">==</span><span class="pln"> </span><span class="str">&#39;__main__&#39;</span><span class="pun">:</span></code></li><li class="L6"><code class="lang-python"><span class="pln">    run</span><span class="pun">(</span><span class="pln">strategy_id</span><span class="pun">=</span><span class="str">&#39;strategy_1&#39;</span><span class="pun">,</span><span class="pln"> filename</span><span class="pun">=</span><span class="str">&#39;main.py&#39;</span><span class="pun">,</span><span class="pln"> mode</span><span class="pun">=</span><span class="pln">MODE_BACKTEST</span><span class="pun">,</span><span class="pln"> token</span><span class="pun">=</span><span class="str">&#39;token_id&#39;</span><span class="pun">,</span></code></li><li class="L7"><code class="lang-python"><span class="pln">        backtest_start_time</span><span class="pun">=</span><span class="str">&#39;2016-06-17 13:00:00&#39;</span><span class="pun">,</span><span class="pln"> backtest_end_time</span><span class="pun">=</span><span class="str">&#39;2017-08-21 15:00:00&#39;</span><span class="pun">)</span></code></li></ol></pre>
<h2 id="h2-u56DEu6D4Bu6A21u5F0Fu4E0Eu5B9Eu65F6u6A21u5F0F"><a name="回测模式与实时模式" class="reference-link"></a><span class="header-link octicon octicon-link"></span>回测模式与实时模式</h2><p>掘金3策略只有两种模式, 回测模式(backtest)与实时模式(live)。在加载策略时指定mode参数。</p>
<h3 id="h3-u56DEu6D4Bu6A21u5F0F"><a name="回测模式" class="reference-link"></a><span class="header-link octicon octicon-link"></span>回测模式</h3><pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-python"><span class="com"># coding=utf-8</span></code></li><li class="L1"><code class="lang-python"><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> print_function</span><span class="pun">,</span><span class="pln"> absolute_import</span><span class="pun">,</span><span class="pln"> unicode_literals</span></code></li><li class="L2"><code class="lang-python"></code></li><li class="L3"><code class="lang-python"><span class="pln"> run</span><span class="pun">(</span><span class="pln">strategy_id</span><span class="pun">=</span><span class="str">&#39;strategy_1&#39;</span><span class="pun">,</span><span class="pln"> filename</span><span class="pun">=</span><span class="str">&#39;main.py&#39;</span><span class="pun">,</span><span class="pln"> mode</span><span class="pun">=</span><span class="pln">MODE_BACKTEST</span><span class="pun">,</span><span class="pln"> token</span><span class="pun">=</span><span class="str">&#39;token_id&#39;</span><span class="pun">,</span></code></li><li class="L4"><code class="lang-python"><span class="pln">     backtest_start_time</span><span class="pun">=</span><span class="str">&#39;2016-06-17 13:00:00&#39;</span><span class="pun">,</span><span class="pln"> backtest_end_time</span><span class="pun">=</span><span class="str">&#39;2017-08-21 15:00:00&#39;</span><span class="pun">)</span></code></li></ol></pre>
<p><code>mode=MODE_BACKTEST</code> 表示回测模式。</p>
<h3 id="h3-u5B9Eu65F6u6A21u5F0F"><a name="实时模式" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实时模式</h3><p>掘金3策略只有两种模式, 回测模式(backtest)与实时模式(live)。在加载策略时指定mode参数。</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-python"><span class="com"># coding=utf-8</span></code></li><li class="L1"><code class="lang-python"><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> print_function</span><span class="pun">,</span><span class="pln"> absolute_import</span><span class="pun">,</span><span class="pln"> unicode_literals</span></code></li><li class="L2"><code class="lang-python"><span class="kwd">from</span><span class="pln"> gm</span><span class="pun">.</span><span class="pln">api </span><span class="kwd">import</span><span class="pln"> </span><span class="pun">*</span></code></li><li class="L3"><code class="lang-python"></code></li><li class="L4"><code class="lang-python"><span class="pln">run</span><span class="pun">(</span><span class="pln">strategy_id</span><span class="pun">=</span><span class="str">&#39;strategy_id&#39;</span><span class="pun">,</span><span class="pln"> filename</span><span class="pun">=</span><span class="str">&#39;main.py&#39;</span><span class="pun">,</span><span class="pln"> mode</span><span class="pun">=</span><span class="pln">MODE_LIVE</span><span class="pun">,</span><span class="pln"> token</span><span class="pun">=</span><span class="str">&#39;token_id&#39;</span><span class="pun">)</span></code></li></ol></pre>
<p><code>mode=MODE_LIVE</code> 表示实时模式。</p>
<h2 id="h2-u63D0u53D6u6570u636Eu7814u7A76"><a name="提取数据研究" class="reference-link"></a><span class="header-link octicon octicon-link"></span>提取数据研究</h2><p>如果只想提取数据，无需实时数据驱动策略, 无需交易下单可以直接通过数据查询函数来进行查询。</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-python"><span class="com"># coding=utf-8</span></code></li><li class="L1"><code class="lang-python"><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> print_function</span><span class="pun">,</span><span class="pln"> absolute_import</span><span class="pun">,</span><span class="pln"> unicode_literals</span></code></li><li class="L2"><code class="lang-python"><span class="kwd">from</span><span class="pln"> gm</span><span class="pun">.</span><span class="pln">api </span><span class="kwd">import</span><span class="pln"> </span><span class="pun">*</span></code></li><li class="L3"><code class="lang-python"></code></li><li class="L4"><code class="lang-python"><span class="pln">set_token</span><span class="pun">(</span><span class="str">&#39;xxxx&#39;</span><span class="pun">)</span></code></li><li class="L5"><code class="lang-python"><span class="pln">data </span><span class="pun">=</span><span class="pln"> history</span><span class="pun">(</span><span class="pln">symbol</span><span class="pun">=</span><span class="str">&#39;SHSE.600000&#39;</span><span class="pun">,</span><span class="pln"> frequency</span><span class="pun">=</span><span class="str">&#39;1d&#39;</span><span class="pun">,</span><span class="pln"> start_time</span><span class="pun">=</span><span class="str">&#39;2015-01-01&#39;</span><span class="pun">,</span><span class="pln"> end_time</span><span class="pun">=</span><span class="str">&#39;2015-12-31&#39;</span><span class="pun">,</span><span class="pln"> fields</span><span class="pun">=</span><span class="str">&#39;open,high,low,close&#39;</span><span class="pun">)</span></code></li></ol></pre>
<p>整个过程只需要两步:</p>
<ol>
<li>set_token 设置用户token，  如果token不正确, 函数调用会抛出异常</li><li>调用数据查询函数， 直接进行数据查询</li></ol>

                </div>
            </div>

    </div>
</div>

</div></body></html>